
## Хранение данных

 - Интерфейс пользователя конкретной площадки (plant) отражает содержимое модели данных интферфейса (state), хранящейся в Redit в виде JSON структуры. Название ключа по которому хранятся эти данные: "rfab:plant:<plid>", где <plid> - идентификатор площадки. Модель на фронтенде автоматически синхронизируется с моделью интерфейса в базе. 

Кроме того, для каждой площадки в Redis накапливается, хранится и обновляется, по мере получения от ядра, дополнительная информация. Она передаётся на фронтенд и отображаются в интерфейсе только по запросу пользователя. Это статистика по каждой полке и дополнительные данные об устройствах в слотах:

 - Статистика по полкам хранится в хешах, доступных по ключу "rfab:jbodstat:<plid>", по каждой площадке отдельно. В качестве названий полей используются индексы полок.

 - Дополнительные данные об устройствах в слотах храняться также в отдельных хешах по каждой площадке, доступных по ключам rfab:dutinfo:<plid>. Названиями полей хеша являются строки вида jbod_idx:slot_idx, где bod_idx - индекс полки, slot_idx - индекс слота.

## Изменение данных
 
Получение данных от ядра для формирования и обновления моделей интерфейсов предполагается для каждой площадки отдельно, по каналам Redis, c названиями rfab:update:<plid>. Сообщения в формате JSON вида {"type": "тип данных", "data": "содержимое"} обрабатываются следующим образом, в зависимости от значения поля "type":

 - "state" - Установка состояния интерфейса, полное обновление. Поле "data" должно содержать полную модель состояния интерфейса, которая будет сохранена в Redis по ключу rfab:plant:<plid>, перезаписав ранее хранившуюся там модель, если таковая была. Пример содержимого поля "data" можно получить здесь http://fab.rlab.ru:9000/docs#/default/getPlant_plant__plid__get после ввода идентификатора площадки (тестовый = 1) и отправки запроса. После получения данных этого типа, помимо обновление информации в базе, происходит обновление модели на фронтенде.

 - "update" - Частичное обновление состояния интерфейса. Поле "data" должно содержать JSON структуру, аналогичную модели данных интерфейса, но содержащую только ту информацию, которой требуется перезаписать соответствующие части модели. Пример сообщения с обновлением номера "wwn1" у полки с индексом "0": {"type": "update", "data": { "jbods": { "0": {"wwn1": "11111111111"}}}}. Результатом такого сообщения также будет обновление модели и в базе и на фронтенде.

- "jbodstat" - Полное обновление (перезапись) в Redis статистики для полок, информация для которых присутствует в поле "data". Например, обновление статистики для полки с индексом "1": { "type": "jbodstat", "data": {"1": "Some jbod statistic"}}. Эти данные на фронтенд в автоматическом режиме не передаются.

- dutinfo - Полное обновление (перезапись) в Redis дополнительной информации об устройствах в слотах, информация о которых присутствует в поле "data". Например, обновление статистики для слота с индексом "3" в полке с индексом "1": { "type": "dutinfo", "data": {"1": { "3": "Some hard drive information"}}}. Эти данные на фронтенд в автоматическом режиме также не передаются.

## Передача действий с фронтенда

Взаимодействие пользователя с элементами управления порождает сообщения, направляемые в канал "rfab:action:<plid>" в формате {"action": "тип действия", "data": "содержимое"}. На данный момент реализованы следующие типы:

- "chosentest" - Выбор теста. В поле "data" передаётся номер теста.

- "abort" - Прекращение теста. В поле data в виде ассоциативного массива JSON передаётся индекс jbod и индексы слотов. Пример: {"action": "reset", "data": {"0": [4, 11, 12]}}. В данном случае передаются индексы слотов "4", "11", "12", находящихся в полке с индексом "0".

- "reset" - Сброс слота. Формат поля "data" аналогичен "abort".

## Дополнительные каналы для удобства отладки
 
 - rfab:err
 - rfab:log

